name: run main.py

on:
  schedule:
  - cron: '0 * * * *'

  push:
    branches:
        - main

env:
  CLIENT_ID: ${{ vars.CLIENT_ID }}
  CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
  TENANT_ID: ${{ vars.TENANT_ID }}
  SUBSCRIPTION_ID: ${{ vars.SUBSCRIPTION_ID }}
  STORAGE_ACCOUNT_NAME: ${{ vars.STORAGE_ACCOUNT_NAME }}
  STORAGE_ACCOUNT_KEY: ${{ secrets.STORAGE_ACCOUNT_KEY }}
  STORAGE_CONTAINER_NAME: ${{ vars.STORAGE_CONTAINER_NAME }}
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout repo content
        uses: actions/checkout@v2

      - name: setup python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: install python packages
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Execute scripts
        run: |
          python resources.py
          python azure_recommendation.py
          python resource_tag_finding.py
